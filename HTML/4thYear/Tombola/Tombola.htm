<!DOCTYPE html>
<html lang="it" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title> TOMBOLA TURILLO LUCA </title>
  <script>
    function tabellone(){
      nome = prompt("Inserisci il tuo nome");
      document.getElementById("numeriEstratti").innerHTML="NUMERI ESTRATTI:" + "</br>"+ "</br>";
      document.getElementById("controlloVittoriaCartella").innerHTML="VINCITE " + nome + ":" + "</br>";
      document.getElementById("controlloVittoriaCPU").innerHTML="VINCITE COMPUTER:" + "</br>";

      // generazione tabellone
      matriceBanco=[[10],[10],[10],[10],[10],[10],[10],[10],[10]];
      s="";
      c = 1;
      s+="<table>";
      s+="</br>";
      for (var i = 1; i <= 9; i++) {
        s+="<tr>";
        for (var j = 1; j <= 10; j++) {
          s+="<td id="+"t"+c+">";
          s+= c;
          matriceBanco[i-1][j-1]=c;
          c++;
          s+="</td>";
        }
        s+="</tr>";
      }
      s+="</table>";
      document.getElementById("sus").innerHTML="Computer";
      document.getElementById("sus").innerHTML+="</br>";
      document.getElementById("sus").innerHTML+=s;

      // cartella casuale del banco
      randomNumber = Math.floor(Math.random() * 6) + 1;
      if (randomNumber == 1) {
        colora(1);
      }else if (randomNumber == 2) {
        colora(6);
      }else if (randomNumber == 3) {
        colora(31);
      }else if (randomNumber == 4) {
        colora(36);
      }else if (randomNumber == 5) {
        colora(61);
      }else{
        colora(66);
      }

      // matrice 9x3
      table = [[],[],[],[],[],[],[],[],[]];

      // generazione di 15 numeri casuali senza ripetizioni compresi tra 1 e 90 e messi all'interno di un array
      // con controllo di massimo 15 numeri nella cartella e con massimo 3 numeri per colonna
      numbers = [];
      col1 = 0; col2 = 0; col3 = 0; col4 = 0; col5 = 0; col6 = 0; col7 = 0; col8 = 0; col9 = 0;
      while (numbers.length < 27) {
        const num = Math.floor(Math.random() * 90) + 1;
        if (!numbers.includes(num)) {
          if (num > 0 && num <= 10 && col1 <= 2) {
            col1++;
            numbers.push(num);
          } else if (num > 10 && num <= 20 && col2 <= 2) {
            col2++;
            numbers.push(num);
          } else if (num > 20 && num <= 30 && col3 <= 2) {
            col3++;
            numbers.push(num);
          } else if (num > 30 && num <= 40 && col4 <= 2) {
            col4++;
            numbers.push(num);
          } else if (num > 40 && num <= 50 && col5 <= 2) {
            col5++;
            numbers.push(num);
          } else if (num > 50 && num <= 60 && col6 <= 2) {
            col6++;
            numbers.push(num);
          } else if (num > 60 && num <= 70 && col7 <= 2) {
            col7++;
            numbers.push(num);
          } else if (num > 70 && num <= 80 && col8 <= 2) {
            col8++;
            numbers.push(num);
          } else if(num > 80 && num <= 90 && col9 <= 2){
            col9++;
            numbers.push(num);
          }
        }
      }

      // ordinamento dei numeri dentro l'array all'interno della tabella
      // col1(0-10),col2(11-20),col3(21-30),col4(31-40),col5(41-50),col6(51-60),col7(61-70),col8(71-80),col9(81-90),
      for (let i = 0; i < numbers.length; i++) {
        const num = numbers[i];
        let col;
        if (num <= 10) {
          col = 0;
        } else if (num <= 20) {
          col = 1;
        } else if (num <= 30) {
          col = 2;
        } else if (num <= 40) {
          col = 3;
        } else if (num <= 50) {
          col = 4;
        } else if (num <= 60) {
          col = 5;
        } else if (num <= 70) {
          col = 6;
        } else if (num <= 80) {
          col = 7;
        } else {
          col = 8;
        }
        table[col].push(num);
      }

      // controllo di massimo 5 numeri per riga
      var exit = false;
      var counter = 0;
      for (var i = 0; i < 3; i++) {
        var rArrayN = [];
        while (!exit) {
          var rNum = Math.floor(Math.random() * 8);
          if (rArrayN.indexOf(rNum) == -1) {
            rArrayN.push(rNum);
            table[rNum][i]="";
            counter++;
            if (counter == 4) {
              counter = 0;
              exit = true;
            }
          }
        }
        exit = false;
      }

      // generazione cartella
      s = "";
      c = 1;
      s+="<table>";
      s+="</br>";
      for (var i = 0; i < 3; i++) {
        s+="<tr>";
        for (var j = 0; j < 9; j++) {
          s+="<td id="+"c"+c+">";
          s+= table[j][i];
          c++;
          s+="</td>";
        }
        s+="</tr>";
      }
      s+="</table>";
      document.getElementById("cartella").innerHTML=nome;
      document.getElementById("cartella").innerHTML+="</br>";
      document.getElementById("cartella").innerHTML+=s;
    }

    // funzione per colorare la cartella del tabellone
    function colora(s){
      cartellaPC = [[],[],[]];
      controlloVittoriaCartellaPC = [[],[],[]];
      var x = s;
      for (var i = 0; i < 3; i++) {
        for (var j = 0; j < 5; j++) {
          cartellaPC[i][j] = x;
          controlloVittoriaCartellaPC[i][j] = 0;
          x++;
        }
        x+=5;
      }

      for (var j = 1; j <= 3; j++) {
        for (var i = s; i <= s + 4; i++) {
          document.getElementById("t" + i).style.backgroundColor = 'white';
          document.getElementById("t" + i).style.borderColor = 'white';
        }
        s += 10;
      }
    }

    // funzione per estrarre un numero casuale compreso tra 1 e 90 senza ripetizioni
    // se il numero estratto e' presente all'interno della cartella lo scrive
    array=[];
    controlloVittoria=[[],[],[]];
    for (var i = 0; i < 3; i++) {
      for (var j = 0; j < 9; j++) {
        controlloVittoria[i][j] = 0;
      }
    }
    bTombola = false;
    function estrai(){
      if (!bTombola) {
        num = 1;
        while (array.indexOf(num) != -1) {
          num = Math.floor(Math.random() * 90) + 1;
        }
        array.push(num);
        document.getElementById("numeriEstratti").innerHTML+= num + ", ";

        //controllo se il numero e' all'interno della cartella
        var c = 0;
        for (var i = 0; i < 3; i++) {
          for (var j = 0; j < 9; j++) {
            c++;
            if (table[j][i] == num) {
              controlloVittoria[i][j] = 1;
              document.getElementById("c" + c).style.backgroundColor = 'green';
            }
            if (cartellaPC[i][j] == num) {
              controlloVittoriaCartellaPC[i][j] = 1;
            }
          }
        }

        //colorazione nel tabellone del numero estratto
        for (var i = 0; i < 9; i++) {
          for (var j = 0; j < 10; j++) {
            document.getElementById("t" + num).style.backgroundColor = 'green';
          }
        }
        controlloVincite();
      }
  }

    ambo = false,terna = false,quaterna = false,cinquina = false,tombola = false;
    function controlloVincite(){
      console.table(controlloVittoriaCartellaPC);
      var numeri = 0, nTombola = 0, CPUnumeri = 0, CPUnTombola = 0 ;
      for (var i = 0; i < 3; i++) {
        for (var j = 0; j < 9; j++) {
          numeri += controlloVittoria[i][j];
          nTombola += controlloVittoria[i][j];
        }
        for (var j = 0; j < 5; j++) {
          CPUnumeri += controlloVittoriaCartellaPC[i][j];
          CPUnTombola += controlloVittoriaCartellaPC[i][j];
        }
        if (numeri==2 && !ambo) {
          document.getElementById("controlloVittoriaCartella").innerHTML+="Ambo" + "</br>";
          ambo = true;
        }else if(numeri==3 && !terna){
          document.getElementById("controlloVittoriaCartella").innerHTML+="Terna" + "</br>";
          terna = true;
        }else if(numeri==4 && !quaterna){
          document.getElementById("controlloVittoriaCartella").innerHTML+="Quaterna" + "</br>";
          quaterna = true;
        }else if(numeri==5 && !cinquina){
          document.getElementById("controlloVittoriaCartella").innerHTML+="Cinquina" + "</br>";
          cinquina = true;
        }
        numeri = 0;

        if (CPUnumeri==2 && !ambo) {
          document.getElementById("controlloVittoriaCPU").innerHTML+="Ambo" + "</br>";
          ambo = true;
        }else if(CPUnumeri==3 && !terna){
          document.getElementById("controlloVittoriaCPU").innerHTML+="Terna" + "</br>";
          terna = true;
        }else if(CPUnumeri==4 && !quaterna){
          document.getElementById("controlloVittoriaCPU").innerHTML+="Quaterna" + "</br>";
          quaterna = true;
        }else if(CPUnumeri==5 && !cinquina){
          document.getElementById("controlloVittoriaCPU").innerHTML+="Cinquina" + "</br>";
          cinquina = true;
        }
        CPUnumeri = 0;
      }

      if (nTombola == 15 && !tombola) {
        document.getElementById("controlloVittoriaCartella").innerHTML="</br>" + "</br>" +"</br>" +"TOMBOLA";
        tombola = true;
        bTombola = true;
      }else if (CPUnTombola == 15 && !tombola) {
        document.getElementById("controlloVittoriaCPU").innerHTML="</br>" + "</br>" +"</br>" +"TOMBOLA";
        tombola = true;
        bTombola = true;
      }
      nTombola = 0;
      CPUnTombola = 0;
    }
  </script>

  <style>
  body{
    background-color: rgb(19, 60, 85);
  }
  div{
    background-color: rgb(89, 165, 216);
    color: black;
  }
  button{
    background-color: rgb(145, 229, 246);
  }
    table, td{
      border: 1px solid black;
    }
    div, button{
      font-family:'Abel';
      font-size:25px;
    }
    #sus{
      position: absolute;
      width: 350px;
      height: 380px;
      top: 0;
      bottom: 300px;
      left: 0;
      right: 500px;
      margin: auto;
      border-radius: 20px;
    }
    #cartella{
      position: absolute;
      width: 350px;
      height: 180px;
      top: 350px;
      bottom: 0px;
      left: 0;
      right: 500px;
      margin: auto;
      border-radius: 20px;
    }
    #controlloVittoriaCartella{
      position: absolute;
      width: 350px;
      height: 180px;
      top: 350px;
      bottom: 0px;
      left: 300px;
      right: 0;
      margin: auto;
      border-radius: 20px;
    }
    #controlloVittoriaCPU{
      position: absolute;
      width: 350px;
      height: 180px;
      top: 350px;
      bottom: 0px;
      left: 1100px;
      right: 0;
      margin: auto;
      border-radius: 20px;
    }
    #numeriEstratti{
      position: absolute;
      width: 350px;
      height: 380px;
      top: 0;
      bottom: 300px;
      left: 300px;
      right: 0;
      margin: auto;
      border-radius: 20px;
    }
    #cartella td{
      width: 25px;
    }
    #btn{
      width: 200px;
      height: 100px;
      position: absolute;
      top:650px;
      bottom: 0;
      left: 0;
      right: 500px;
      margin: auto;
    }
  </style>
  </head>
  <body onload="tabellone()">
    <center>
      <div id="sus">
      </div>
      <div id="numeriEstratti">
      </div>
      <div id="controlloVittoriaCartella">
      </div>
      <div id="controlloVittoriaCPU">
      </div>
      <div id="cartella">
      </div>
      <button id="btn" onclick="estrai()">ESTRAI</button>
    </center>
  </body>
</html>
